const URL_API = 'http://localhost:3000';

async function r() {
  const headers = new Headers();
  if (headers.get('blocked') === 'true') return;

  const params = new URLSearchParams(window.location.search);
  const campaign_id = document
    .querySelector(`script[src="${URL_API}/cdn/r.min.js"]`)
    .getAttribute('data-campaign');
  if (params.get('connect')?.length && window.opener) return;

  const params_url = params.get('p');
  if (!campaign_id) return;

  window.location.href = `${URL_API}/${campaign_id}.${params_url}${window.location.search.replace(
    `p=${params.get('p')}`,
    `origin=${window.location.origin}`,
  )}`;
}

r();
