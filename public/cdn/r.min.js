const URL_API = 'http://cloaker-devstyle.vercel.com';

async function r() {
  const isBlocked = document.cookie.includes('block=true');
  if (isBlocked) {
    document.cookie = 'block=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
    return;
  }

  const params = new URLSearchParams(window.location.search);
  const campaign_id = document
    .querySelector(`script[src="${URL_API}/cdn/r.min.js"]`)
    .getAttribute('data-campaign');
  if (params.get('connect')?.length && window.opener) return;

  const params_url = params.get('p');
  if (!campaign_id) return;

  const url = new URL(
    `${URL_API}/${campaign_id}.${params_url}?origin=${
      window.location.origin
    }&${window.location.search.replace('?', '')}`,
  );

  window.location.href = url.toString();
}

r();
